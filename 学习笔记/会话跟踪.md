# web中的四种会话跟踪方式（用于解决http的无状态问题）

## 基本认识
会话是指客户端打开与服务器端连接,发出请求，服务器端响应客户端的全过程。

那么什么是会话跟踪呢？
对同一个用户的对同一个服务器的请求和接收响应的监视

为什么使用会话跟踪
因为浏览器和服务器的通信是使用的http协议，而http协议是无状态的协议。它不能保存客户端的信息，一次响应之后就断开了（这里要对http2.0进行思考）
当下一次客户端需要进行连接时，需要重新连接，这样就需要判断是否是同一个用户，所以就需要会话跟踪技术来实现这种要求。

过程：当服务器响应客户端的第一次请求时将会创建一个新的session对象(该对象实现了一个HttpSession接口)，和一个唯一的ID分配给该请求，以后 客户将此会话ID与请求一起传给服务器，此会话ID在后续的请求中会将用户与session对象进行匹配，用于识别不同的客户。
解释HttpSession：当需要为用户端建立一个session时，servlet容器就创建了一个HttpSession对象。其中存储了和本session相关的信息。所以，在一个servlet中有多少个不同用户连接，就会有多少个HttpSession对象。
Servlet容器就是用来装Servlet的。Java Servlet 是运行在 Web 服务器或应用服务器上的程序，它是作为来自 Web 浏览器或其他 HTTP 客户端的请求和 HTTP 服务器上的数据库或应用程序之间的中间层。使用 Servlet，您可以收集来自网页表单的用户输入，呈现来自数据库或者其他源的记录，还可以动态创建网页。

##  会话跟踪常用的方法
### 1. URL重写
URL(统一资源定位符)是Web上特定页面的地址，URL重写的技术就是在URL结尾添加一个附加数据以标识该会话,把会话ID通过URL的信息传递过去，以便在服务器端进行识别不同的用户 。
如果用户没有禁用cookie，而且又使用URL重写，则：用户在第一次访问EncodeURLServlet时，由于不知道用户是否禁用了 cookie，所以response.encodeURL()方法内部会将JSESSIONID重写在url上，但是一旦第二次访问时，由于用户是带着 cookie来的，所以response.encodeURL()不会将JSESSIONID重写在url上。
但是如果用户禁用cookie，则关闭了浏览器后，重新开启浏览器，则回话失效，无法实现回话跟踪；如果是用户没有禁用cookie，则可以通过设置装载JSESSIONID的cookie的失效时间来控制浏览器关闭后session仍未失效。

### 2. 隐藏表单域
将会话ID添加到HTML表单元素中提交到服务器,此表单元素并不在客户端显示 。
HTML 表单中可以含有如下的条目：<input type="hidden" name="session" value="a1234">

这个条目的意思是：在提交表单时，要将指定的名称和值自动包括在 GET 或 POST 数据中。这个隐藏域可以用来存储有关会话的信息，但它的主要缺点是：仅当每个页面都是由表单提交而动态生成时，才能使用这种方法。单击常规的超文本链接并不产生表单提交，因此隐藏的表单域不能支持通常的会话跟踪，只能用于一系列特定的操作中，比如在线商店的结账过程。

### 3. Cookie
Cookie是Web服务器发送给客户端的一小段信息，客户端请求时可以读取该信息发送到服务器端，进而进行用户的识别。对于客户端的每次请求，服务器都会将Cookie发送到客户端,在客户端可以进行保存,以便下次使用。
客户端可以采用两种方式来保存这个Cookie对象，一种方式是保存在客户端内存中，称为临时Cookie，浏览器关闭后 这个Cookie对象将消失。另外一种方式是保存在 客户机的磁盘上，称为永久Cookie。以后客户端只要访问该网站，就会将这个Cookie再次发送到服务器上，前提是 这个Cookie在有效期内。这样就实现了对客户的跟踪。
Cookie是可以被禁止的。
Cookie默认的maxAge值为-1。
如果maxAge为0，则表示删除该Cookie。Cookie机制没有提供删除Cookie的方法，因此通过设置该Cookie即时失效实现删除Cookie的效果。

### 4. Session
每一个用户都有一个不同的session，各个用户之间是不能共享的，是每个用户所独享的，在session中可以存放信息。在服务器端会创建一个session对象，产生一个sessionID来标识这个session对象，然后将这个sessionID放入到Cookie中发送到客户端，下一次访问时，sessionID会发送到服务器，在服务器端进行识别不同的用户。Session是依赖Cookie的，如果Cookie被禁用，那么session也将失效。因为Session是用Session ID来确定当前对话所对应的服务器Session，而Session ID是通过Cookie来传递的，禁用Cookie相当于失去了Session ID，也就得不到Session了。此时可以考虑URL重写和表单隐藏域。
